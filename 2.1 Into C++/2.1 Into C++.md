# 进入C++

## 前言

在开始这期视频之前，我要提出一点，就是当你发现有些东西听不懂的时候，可以先跳过去。因为有些内容并非是给初学者准备的，而是给有一定基础的人做复习的。

大家好，这里是一起读C++ Primer Plus第二期，这期我们一起读的是这本书的2.1：进入C++。这期视频我们会从一个示例程序开始，并围绕它展开这期视频的内容。光说不练是假把式，我们以后也会以代码为主，通过代码来穿插知识点。  
如上期视频中提到的，本期视频，或者说这个系列的视频，都会使用Visual Studio来演示。（除非遇到特殊情况）

## 程序示例

我们先来看这个示例程序的代码：[myfirst.cpp](../cppPrimerPlus-six--master/Chapter%202/myfirst.cpp)。它将输出这样的两行文字。

在介绍这些代码都是什么含义之前，我有必要针对新手常犯的一些错误打几针预防针。  
首先，C++是对大小写敏感的，这也就意味着，你只能写`cout`,而非`Cout`或者`COUT`。另外，C++也对拼写敏感，打错字母也是新手常犯的错误之一，例如将`stdio.h`写成`studio.h`。还有一个容易看错的单词，就是`endl`：它的最后一个符号是字母`l`,而非数字`1`。

## 注释

注释有两种形式，行注释和C-风格注释。行注释以双斜杠`//`开始，注意，`/`这个叫做斜杠，而`\`这个叫做反斜杠。一行中，如果出现了双斜杠，那么它以及它后面的内容都会被忽略，这就是行注释的形式。而C-风格的注释是以`/*`开始，以`*/`结束，中间的内容都会被忽略。为了能看清，一般在块形式的C-风格注释中，每行的开头会加上一个`*`。  
要注意的是，注释是给你自己，或者别的程序员看的，或者说，是给人看的，在编译器眼里并不存在注释。你看到的代码长这个样子，而编译器看到的代码其实长这个样子。

由于我们使用Visual Studio进行学习，所以可以忽略这四行注释。如果你使用的是其他的IDE，有可能需要加上这两行。也就是把代码写成这个样子。这是因为Visual Studio在程序结束后不会关闭窗口而是等着你按下任意键，但某些IDE给出的窗口就会在程序结束后直接关闭。

## 除去注释，剩下的这些东西都是什么？

这个示例程序除去注释之后还剩下这些东西：预处理器编译指令；函数头；编译指令using namespace；函数体；cout语句；结束函数的return语句。  
接下来我们一个一个介绍这些东西。

## main函数
去掉注释，我们发现占地面积最大的是这个main函数。不过，在理解main函数之前，我们需要先知道什么是函数。

这里的函数和数学上的函数有一些区别。我们可以用三个基本特征来描述它：接受一些参数，进行一些操作，返回一个值。不过这三个特征都不是必须的，一个函数可以不接受参数，也可以不做操作，也可以不返回值。甚至这三个它可以都没有，不过这样的函数似乎没有什么实际意义，我们不予讨论。

函数的格式是这样的：先有一个返回类型，`void`表示不返回值。然后是函数的名字，它是这个函数的标识符。在后面是一对括号，括号里是它接受的参数，如果是空的或者写了`void`，那么它就不接受参数（在C语言标准里，括号里空着表示对是否接收参数保持沉默）。在后面是一对大括号，里面是函数体，也就是函数的主要部分。函数体里有一些语句，是函数被调用时所做的操作。每条语句最后要加一个分号，当然了，是英文符号。分号也是语句的一部分，它被称为终止符，是语句的结束标记。函数体中的`return`语句标志着这个函数的结束。同时会返回一个值。当然了，如果是`void`函数，`return`语句后面不会加东西，它也会结束这个函数。

main函数当然也是函数，它也没有什么特殊性。只不过，每个程序都有且只有一个main函数，它是这个程序的入口。程序从main函数的第一条语句开始执行，到main函数的return语句结束。

有的小朋友可能就要问了：main函数也有参数接受和返回值，那它接受谁的参数，又返回给谁呢？其实main函数也是要被调用的，调用它的是系统，所以参数是系统给的，而返回值也是返回给系统的。这么说也不太准确，代码最后被编译成程序之前，会添加一段启动代码，其实是这段启动代码调用的main函数。而这段代码就是系统和程序之间的桥梁。

## 预处理器编译指令

预处理器处理名称以`#`开头的编译指令。我们的这个程序使用了`#include`编译指令`#include <iostream>`，它会把`iostream`这个文件中的内容添加到程序中。我们可以打开这个文件，然后发现这些我们都看不懂。不过没有关——系，我们不需要看懂，会用就可以。`iostream`这类的文件称为头文件，或者包含文件。你也可以自己写一个头文件。一般来说，用尖括号括起来的是标准库，而用引号括起来的是自己写的头文件。不过这并不准确，但也无伤大雅。我们先这样认为就可以了。

但是，等等。我们为什么要把`iostream`里的内容添加到这里呢？这是为了使用其中的`cout`对象。嗯？`cout`对象？对象又是什么？在这里我们先不用纠结对象是什么，我们可以认为它是一个黑箱子，或者当成一个高级的函数。总之，它究竟是什么并不重要，我们只要知道，它是用来输出这一串文字的。`<<`这是一个操作符，我们可以形象地把这个理解为把右边的内容丢进左边。右面是什么？是一串字符串，也就是用引号括起来的一些字符。现在我们大概理解了：我们用`#include`指令把`iostream`文件中的内容添加进来，这样我们就可以使用其中的`cout`对象在命令行中输出一个字符串。这一节毕竟只是在讲预处理器的编译指令，我们不过多着墨。

编译器自带的头文件有很多格式，但这些并不是重要的东西，因此我们只贴一张图在这里，供大家参考。

| 头文件类型 | 约定 | 示例 | 说明 |
|-----------|------|-----|------|
|C++旧式风格|以`.h`结尾|`iostream.h`|C++程序可以使用|
|C旧式风格|以`.h`结尾|`math.h`|C、C++程序可以使用|
|C++新式风格|没有扩展名|`iostream`|C++程序可以使用，使用`namespace std`|
|转换后的C|加上前缀`c`，没有扩展名|`cmath`|C++程序可以使用，可以使用不是C的特性，如`namespace std`|

## `using`编译指令和名称空间

如果使用的是`iostream`而非`iostream.h`，在使用`cin`对象前就需要用到这条`using`编译指令。它的意思是使用`std`这个名称空间里的名字。在你一头雾水之前，我们先来看看名称空间是什么吧。

名称空间支持是一项C++特性。我们先解释为什么需要这个东西。假如你在写一个比较大型的项目，这里面有很多的函数、对象，而且你也include了一系列头文件。汉字那么多，重名的人却一点也不少，而英文就26个字母，分开大小写也就顶天五十多个，重名自然是不可避的。为了避免重名，名称空间应运而生。

比如我们有一个叫LiHua的库，这里面有个函数run()，而我们还有一个叫HanMeiMei的库，里面也有一个函数叫run()，那么我们要使用run函数的时候，究竟是用的哪一个呢？名称空间就是用来区分重名函数的。我们可以把LiHua库里面的函数、对象等放到叫做LiHua的名称空间里，而把HanMeiMei库里面的这些放到叫做HanMeiMei的名称空间里，这样，我们如果想用LiHua库里的run()函数，只需要这样写：

```
LiHua::run();
```

而我们的`iostream`属于标准库，所以这些都在`std`名称空间里，也就是说，其实我们可以直接这样写：

```
std::cout << "Hello World!\n";
```

当然了，每次都多写三个字母和两个冒号，自然不是我们这样的懒人所喜闻乐见的，于是有了`using`指令。`using`指令有两种用法，其一是让整个名称空间中的名称都可以直接使用而不必加前缀，其二是指定某个函数或对象，让这个特定的函数或对象可以直接使用。

不过我们再思考一下——用了`using namespace std;`，那我们最开始防止重名的设想不是白瞎了吗？确实。但无伤大雅。因为我们又没在写什么大工程，根本没有重名的担忧。不过当然了，`using namespace std;`确实会被一些人认为是陋习，这个随你便，你可以用，也可以选择不用，每个标准库对象、函数都在前面加上`std::`。

`using`还有另外一种用法，也就是类型别名。在C语言中，这个操作是用`typedef`指令来实现的。比如说，有一个复合类型名字很长，长这个样子：

```
int* (*(StrangeType[5])) ();
```

它是一个指针数组，里面的指针指向的是返回值为`int`指针的函数。这玩意看起来就很搞，我们就可以用`typedef`指令来把它换成另一个好记的东西，比如像这样：

```
typedef int* (*(StrangeType[5])) ();
```

这样，我们要声明这样一个数组的时候，只需要这样写：

```
StrangeType anArray;
```

或者这样写：

```
typedef int* pt2int;
pt2int aPointer;
```

说了这么多，我们终于可以引出`using`的另一个用法了，也就是——江江，别名！其实`using`的用法和`typedef`差不多，略有区别而已，我们看下例子就应该明白了。

```
using st = int*(*([4]))();
using inta = int;
st a;
a[2] = &Afunction;
inta b;
```

## 使用`cout`进行C++输出

我们首先了解一下C++是怎么输出的。我们现在是在命令提示符中，所以输入输出都是字符。我们可以把输出当成一条河流，那么它就是一个输出流。或者你也可以把它当成流水线。总之，你可以形象地理解一下这个“流”的概念。那么我们是如何输出文字的呢？答案就是：把它插入到输出流里。这是比较抽象的一个概念，不过换个角度想它其实也很具体。总的说来，我们并不能做到想让这个程序显示什么它就显示什么，而是我们把要输出的内容放进这个流里，之后它再把这个流中的文字输出到屏幕上。

有了这样的概念之后，我们就知道`cout`在做什么了。它就是用来把我们要输出的东西插入到输出流中的一个工具。而且它是一个智能的工具，可以根据你给它的数据的类型来决定输出格式。比如，你给他一个整型变量，他就会把它的值输出；你给它一个字符，他就输出一个字符；你给它一个指针，他就输出这个指针的地址；你给它一个字符串，它就把字符串的这一串文字输出。

另外还有一个我们不认识的符号，这个`endl`是做什么的？我们可以找到它的定义。如果你已经学过一段时间C++，虽然你已经知道`endl`，但只看这里你应该也能看个大概了，就是往输出流里加一个回车，再刷新一下输出流。如果你刚刚入门，可以简单地把这个当成一个换行符来用。

我们还有另一种换行的方法，就是在字符串里加一个“`\n`”。这里我们就要提一嘴转义字符了。众所周知，有些控制符号是没法直接表示出来的，那么我们就需要转义字符来表示，比如“`\n`”表示换行，“`\a`”表示响铃。那么聪明的小朋友又有问题了：反斜杠自己该怎么表示呢？好问题，那就转义自己好了！也就是说，用“`\\`”来表示反斜杠。

我们把C++中常见的转义字符列个表在这里：

|字符形式|ASCII码|英文释义|实际含义|
|----|----|----|----|
|`\a`|0x07|alarm|蜂鸣器响铃一声|
|`\n`|0x0a|new line|换行|
|`\t`|0x09|tab|横向跳格|
|`\v`|0x0b|vertical tab|竖向跳格|
|`\b`|0x08|backspace|退格|
|`\r`|0x0d|return|回车|
|`\\`|0x5c|`\`|反斜线|
|`\"`|0x22|"|双引号|
|`\'`|0x27|'|单引号|
|`\ooo`|||八进制数|
|`\xhh`|||十六进制数|

`o`为8进制数，可以是1~3位，`h`为16进制数，可以是1~2位。

## C++源代码的格式化

有一些语言，比如FORTRAN、python，是面向行的，也就是说它的每条语句都要占一行。那么这些语言里回车的作用就是把语句分开，或者说回车是语句的分隔符。然而在C++中，分号作为终止符，已经标示了语句的结尾，那么在C++里面，空格、制表符，也就是tab和回车都可以被称为空白，一般来说他们是可以互换的。

我们可以把刚刚的那段代码格式化成这个样子：

```
#include <iostream>
        int 
main
() {
    using 
    namespace 
    std; cout 
        << 
    "Come up and C++ me some time."
    ;    cout << 
    endl; cout << 
    "You won't regret it!" << 
    endl; return 0; }
```

不过，有些地方是不能随便加空格回车的，为了知道为什么，我们可以先了解一下标记和空白的概念。一行代码中不能分割的元素就叫做标记，标记之间要用空白隔开。一个变量或函数的名字是一个标记。一个括号就是一个标记。然而两个括号之间可以没有空白也可以有空白，毕竟它们又不会和别的混淆。一个语句结束后，加完分号也是可以直接开始下一个语句的，因为这也没有歧义。由此可见，标记这个概念还是为了防止单词的混淆。空白的概念我们已经知道了，就是空格、tab和回车。所以说，如果你想在main这个单词中间加个空白，这是不可以的，因为这样编译器也就认不出你在写什么了。

虽然你现在知道，你甚至可以把所有代码写到一行，但这显然是几乎没什么可读性的。为了别人，也为了你自己能看懂，我们有这样几个大概的原则。

- 每条语句占一行
- 函数的两个花括号各占一行，不过第一个大括号也可以不另起一行。
- 函数中的语句都相对花括号缩进
- 与函数名称相关的圆括号周围没有空白
